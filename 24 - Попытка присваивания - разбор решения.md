В целом моё решение похоже на эталонное, но надо хорошенько разобраться с генериками, выявил слабое место своё.
